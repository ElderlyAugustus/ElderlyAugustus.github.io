<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>2022-06-04-GAMES104现代游戏引擎-Lecture11-Physics System - Applications | xα&#39;s blog</title>
<meta name="keywords" content="现代游戏引擎">
<meta name="description" content="Lecture11 Physics System - Applications Character Controller 一个反物理的系统：符合玩家感知 &#43; 实现反物理运动 没有Character Controller时，大量Hack Kinematic Actor 不受物理规律控制 Push其他Actor Shape （人类角色时） Capsule 主要使用，一般设计两层 内层：碰撞 外层：防止角色与物体（墙面）太近 高速移动时容易卡进墙体 相机穿透导致看到墙后物体 Box Convex Collide with environment Sweep Test 判断 Sliding：撞到墙上时左右滑动 Auto Stepping：台阶 每帧尝试抬升高度前进 Slope 斜坡 坡度大于多少时，冲上去会滑下来 改变Controller形状/体积 eg.蹲下站起的变化 限制在环境大小不够时不可站起（eg.在隧道中） 更新前重叠测试，阻止形状更新 Push Objects (Dynamic Actors) Controller站在运动平台上时 不作处理就会平台动、Controller在原地 Ray Cast检测所站物体上，绑定，运动时也相对于平台 进一步精细：平台运动过快时的趔趄等 Ragdoll 不适用Ragdoll：播放死亡动画 =&gt; 死亡环境并不一定与动画一致 eg. 在悬崖边，悬空挂在坡面上甚至插入地形 用Rigid Body将关键的Joint连结起来 考虑Constraints 将Ragdoll中较少Joints的运动映射到Skeleton Animation Retargeting 三种Joints Active Joints：与Ragdoll相同的Joints，直接使用Ragdoll数据 Leaf Joints：一般不动，例如手掌脚掌 Intermediate Joints：Active Joints之间的Joints，利用邻近Active Joints插值 死亡动画到Ragdoll的过渡 一个问题：游戏中动画与物理的边界在哪里？ Powered Ragdoll - Physics-Animation Blending 纯Ragdoll：效果不像人类 纯动画：循环播放，有模式感 两种混合 Cloth 传统：Bake动画，随着运动方向更换动画，移动端常用">
<meta name="author" content="xα">
<link rel="canonical" href="//elderlyaugustus.github.io/posts/2022-06-04-games104%E7%8E%B0%E4%BB%A3%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-lecture11-physicssystemapplications.html">

<link crossorigin="anonymous" href="../assets/css/stylesheet.min.8557677b96aef9ab17733bd031b66e9a516d50a5288baa05010b3cb7336fb748.css" integrity="" rel="preload stylesheet" as="style">
<link rel="icon" href="//elderlyaugustus.github.io/icons/favicon.ico">
<link rel="apple-touch-icon" href="//elderlyaugustus.github.io/icons/apple-touch-icon.png">
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="2022-06-04-GAMES104现代游戏引擎-Lecture11-Physics System - Applications | xα&#39;s blog" />
<meta name="twitter:description" content="Lecture11 Physics System - Applications Character Controller 一个反物理的系统：符合玩家感知 &#43; 实现反物理运动 没有Character Controller时，大量Hack Kinematic Actor 不受物理规律控制 Push其他Actor Shape （人类角色时） Capsule 主要使用，一般设计两层 内层：碰撞 外层：防止角色与物体（墙面）太近 高速移动时容易卡进墙体 相机穿透导致看到墙后物体 Box Convex Collide with environment Sweep Test 判断 Sliding：撞到墙上时左右滑动 Auto Stepping：台阶 每帧尝试抬升高度前进 Slope 斜坡 坡度大于多少时，冲上去会滑下来 改变Controller形状/体积 eg.蹲下站起的变化 限制在环境大小不够时不可站起（eg.在隧道中） 更新前重叠测试，阻止形状更新 Push Objects (Dynamic Actors) Controller站在运动平台上时 不作处理就会平台动、Controller在原地 Ray Cast检测所站物体上，绑定，运动时也相对于平台 进一步精细：平台运动过快时的趔趄等 Ragdoll 不适用Ragdoll：播放死亡动画 =&gt; 死亡环境并不一定与动画一致 eg. 在悬崖边，悬空挂在坡面上甚至插入地形 用Rigid Body将关键的Joint连结起来 考虑Constraints 将Ragdoll中较少Joints的运动映射到Skeleton Animation Retargeting 三种Joints Active Joints：与Ragdoll相同的Joints，直接使用Ragdoll数据 Leaf Joints：一般不动，例如手掌脚掌 Intermediate Joints：Active Joints之间的Joints，利用邻近Active Joints插值 死亡动画到Ragdoll的过渡 一个问题：游戏中动画与物理的边界在哪里？ Powered Ragdoll - Physics-Animation Blending 纯Ragdoll：效果不像人类 纯动画：循环播放，有模式感 两种混合 Cloth 传统：Bake动画，随着运动方向更换动画，移动端常用" />
<meta property="og:title" content="2022-06-04-GAMES104现代游戏引擎-Lecture11-Physics System - Applications | xα&#39;s blog" />
<meta property="og:description" content="Lecture11 Physics System - Applications Character Controller 一个反物理的系统：符合玩家感知 &#43; 实现反物理运动 没有Character Controller时，大量Hack Kinematic Actor 不受物理规律控制 Push其他Actor Shape （人类角色时） Capsule 主要使用，一般设计两层 内层：碰撞 外层：防止角色与物体（墙面）太近 高速移动时容易卡进墙体 相机穿透导致看到墙后物体 Box Convex Collide with environment Sweep Test 判断 Sliding：撞到墙上时左右滑动 Auto Stepping：台阶 每帧尝试抬升高度前进 Slope 斜坡 坡度大于多少时，冲上去会滑下来 改变Controller形状/体积 eg.蹲下站起的变化 限制在环境大小不够时不可站起（eg.在隧道中） 更新前重叠测试，阻止形状更新 Push Objects (Dynamic Actors) Controller站在运动平台上时 不作处理就会平台动、Controller在原地 Ray Cast检测所站物体上，绑定，运动时也相对于平台 进一步精细：平台运动过快时的趔趄等 Ragdoll 不适用Ragdoll：播放死亡动画 =&gt; 死亡环境并不一定与动画一致 eg. 在悬崖边，悬空挂在坡面上甚至插入地形 用Rigid Body将关键的Joint连结起来 考虑Constraints 将Ragdoll中较少Joints的运动映射到Skeleton Animation Retargeting 三种Joints Active Joints：与Ragdoll相同的Joints，直接使用Ragdoll数据 Leaf Joints：一般不动，例如手掌脚掌 Intermediate Joints：Active Joints之间的Joints，利用邻近Active Joints插值 死亡动画到Ragdoll的过渡 一个问题：游戏中动画与物理的边界在哪里？ Powered Ragdoll - Physics-Animation Blending 纯Ragdoll：效果不像人类 纯动画：循环播放，有模式感 两种混合 Cloth 传统：Bake动画，随着运动方向更换动画，移动端常用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="//elderlyaugustus.github.io/posts/2022-06-04-games104%E7%8E%B0%E4%BB%A3%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-lecture11-physicssystemapplications.html" />
    <meta property="og:image" content="//elderlyaugustus.github.io/cover.png"/>
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2022-06-04T17:00:00&#43;08:00" />
  <meta property="article:modified_time" content="2022-06-04T17:00:00&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "2022-06-04-GAMES104现代游戏引擎-Lecture11-Physics System - Applications",
      "item": "//elderlyaugustus.github.io/posts/2022-06-04-games104%E7%8E%B0%E4%BB%A3%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-lecture11-physicssystemapplications.html"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "2022-06-04-GAMES104现代游戏引擎-Lecture11-Physics System - Applications | xα's blog",
  "name": "2022-06-04-GAMES104现代游戏引擎-Lecture11-Physics System - Applications",
  "description": "Lecture11 Physics System - Applications Character Controller 一个反物理的系统：符合玩家感知 + 实现反物理运动 没有Character Controller时，大量Hack Kinematic Actor 不受物理规律控制 Push其他Actor Shape （人类角色时） Capsule 主要使用，一般设计两层 内层：碰撞 外层：防止角色与物体（墙面）太近 高速移动时容易卡进墙体 相机穿透导致看到墙后物体 Box Convex Collide with environment Sweep Test 判断 Sliding：撞到墙上时左右滑动 Auto Stepping：台阶 每帧尝试抬升高度前进 Slope 斜坡 坡度大于多少时，冲上去会滑下来 改变Controller形状/体积 eg.蹲下站起的变化 限制在环境大小不够时不可站起（eg.在隧道中） 更新前重叠测试，阻止形状更新 Push Objects (Dynamic Actors) Controller站在运动平台上时 不作处理就会平台动、Controller在原地 Ray Cast检测所站物体上，绑定，运动时也相对于平台 进一步精细：平台运动过快时的趔趄等 Ragdoll 不适用Ragdoll：播放死亡动画 =\u0026gt; 死亡环境并不一定与动画一致 eg. 在悬崖边，悬空挂在坡面上甚至插入地形 用Rigid Body将关键的Joint连结起来 考虑Constraints 将Ragdoll中较少Joints的运动映射到Skeleton Animation Retargeting 三种Joints Active Joints：与Ragdoll相同的Joints，直接使用Ragdoll数据 Leaf Joints：一般不动，例如手掌脚掌 Intermediate Joints：Active Joints之间的Joints，利用邻近Active Joints插值 死亡动画到Ragdoll的过渡 一个问题：游戏中动画与物理的边界在哪里？ Powered Ragdoll - Physics-Animation Blending 纯Ragdoll：效果不像人类 纯动画：循环播放，有模式感 两种混合 Cloth 传统：Bake动画，随着运动方向更换动画，移动端常用",
  "keywords": [
    "现代游戏引擎"
  ],
  "wordCount" : "466",
  "inLanguage": "en",
  "datePublished": "2022-06-04T17:00:00+08:00",
  "dateModified": "2022-06-04T17:00:00+08:00",
  "author":[{
    "@type": "Person",
    "name": "xα"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "//elderlyaugustus.github.io/posts/2022-06-04-games104%E7%8E%B0%E4%BB%A3%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-lecture11-physicssystemapplications.html"
  },
  "publisher": {
    "@type": "Organization",
    "name": "xα's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "//elderlyaugustus.github.io/favicon.ico"
    }
  }
}
</script>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>


<script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  
    window.addEventListener('load', (event) => {
        document.querySelectorAll("mjx-container").forEach(function(x){
          x.parentElement.classList += 'has-jax'})
      });
  
  </script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="//elderlyaugustus.github.io/" accesskey="h" title="xα&#39;s blog (Alt + H)">xα&#39;s blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="//elderlyaugustus.github.io/about/" title="About"
                >About
                </a>
            </li>
            <li>
                <a href="//elderlyaugustus.github.io/archives/" title="Archives"
                >Archives
                </a>
            </li>
            <li>
                <a href="//elderlyaugustus.github.io/search/" title="Search (Alt &#43; /)"data-no-instant accesskey=/
                >Search
                </a>
            </li>
            <li>
                <a href="//elderlyaugustus.github.io/tags/" title="Tags"
                >Tags
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="//elderlyaugustus.github.io/">Home</a></div><h1 class="post-title">2022-06-04-GAMES104现代游戏引擎-Lecture11-Physics System - Applications</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>2022-06-04</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="//elderlyaugustus.github.io/tags/%E7%8E%B0%E4%BB%A3%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E.html">现代游戏引擎</a></span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#character-controller" aria-label="Character Controller">Character Controller</a></li>
                <li>
                    <a href="#ragdoll" aria-label="Ragdoll">Ragdoll</a></li>
                <li>
                    <a href="#cloth" aria-label="Cloth">Cloth</a><ul>
                        
                <li>
                    <a href="#self-collision" aria-label="Self Collision">Self Collision</a></li></ul>
                </li>
                <li>
                    <a href="#destruction" aria-label="Destruction">Destruction</a></li>
                <li>
                    <a href="#vehicle" aria-label="Vehicle">Vehicle</a></li>
                <li>
                    <a href="#advanced-physics-pbd-xpbd" aria-label="Advanced Physics : PBD / XPBD">Advanced Physics : PBD / XPBD</a><ul>
                        
                <li>
                    <a href="#pbd-position-based-dynamics" aria-label="PBD, Position Based Dynamics">PBD, Position Based Dynamics</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="lecture11-physics-system---applications">Lecture11 Physics
System - Applications</h3>
<h4 id="character-controller">Character Controller</h4>
<ul>
<li>一个反物理的系统：符合玩家感知 + 实现反物理运动</li>
<li>没有Character Controller时，大量Hack</li>
<li>Kinematic Actor
<ul>
<li>不受物理规律控制</li>
<li>Push其他Actor</li>
</ul></li>
<li>Shape （人类角色时）
<ul>
<li><strong>Capsule</strong> 主要使用，一般设计两层
<ul>
<li>内层：碰撞</li>
<li>外层：防止角色与物体（墙面）太近
<ul>
<li>高速移动时容易卡进墙体</li>
<li>相机穿透导致看到墙后物体</li>
</ul></li>
</ul></li>
<li>Box</li>
<li>Convex</li>
</ul></li>
<li>Collide with environment
<ul>
<li>Sweep Test 判断</li>
<li>Sliding：撞到墙上时左右滑动
<img src="../images/games104/L11_Sliding.png" alt="L11_Sliding" style="zoom: 25%;" /></li>
<li>Auto Stepping：台阶 每帧尝试抬升高度前进
<img src="../images/games104/L11_AutoStepping.gif" alt="L11_AutoStepping" style="zoom:25%;" /></li>
<li>Slope 斜坡
<ul>
<li>坡度大于多少时，冲上去会滑下来</li>
</ul></li>
<li>改变Controller形状/体积 eg.蹲下站起的变化
<ul>
<li>限制在环境大小不够时不可站起（eg.在隧道中）
更新前重叠测试，阻止形状更新</li>
</ul></li>
<li>Push Objects (Dynamic Actors)</li>
<li>Controller站在运动平台上时
<ul>
<li>不作处理就会平台动、Controller在原地</li>
<li>Ray Cast检测所站物体上，绑定，运动时也相对于平台</li>
<li>进一步精细：平台运动过快时的趔趄等</li>
</ul></li>
</ul></li>
</ul>
<h4 id="ragdoll">Ragdoll</h4>
<ul>
<li>不适用Ragdoll：播放死亡动画 =&gt; 死亡环境并不一定与动画一致 eg.
在悬崖边，悬空挂在坡面上甚至插入地形</li>
<li>用Rigid Body将关键的Joint连结起来
<img src="../images/games104/L11_RigdollJoints.jpg" alt="L11_RigdollJoints" style="zoom:30%;" />
<ul>
<li>考虑Constraints</li>
<li>将Ragdoll中较少Joints的运动映射到Skeleton
<ul>
<li><strong>Animation Retargeting</strong></li>
<li>三种Joints
<img src="../images/games104/L11_RagdollAnimation.png" alt="L11_RagdollAnimation" style="zoom:25%;" />
<ul>
<li>Active Joints：与Ragdoll相同的Joints，直接使用Ragdoll数据</li>
<li>Leaf Joints：一般不动，例如手掌脚掌</li>
<li>Intermediate Joints：Active Joints之间的Joints，利用邻近Active
Joints插值</li>
</ul></li>
</ul></li>
<li>死亡动画到Ragdoll的过渡
<ul>
<li>一个问题：游戏中动画与物理的边界在哪里？</li>
<li>Powered Ragdoll - Physics-Animation Blending
<ul>
<li>纯Ragdoll：效果不像人类</li>
<li>纯动画：循环播放，有模式感</li>
<li>两种混合
<img src="../images/games104/L11_PoweredRagdoll.jpg" alt="L11_PoweredRagdoll" style="zoom:25%;" /></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<h4 id="cloth">Cloth</h4>
<ul>
<li><p>传统：Bake动画，随着运动方向更换动画，移动端常用</p></li>
<li><p>动力学骨骼模拟：精度较低</p></li>
<li><p>Mesh-based Cloth Simulation ##### Mesh-based Cloth
Simulation</p></li>
<li><p>Physical Mesh远低于Render Mesh，模拟完再用重心坐标插值到Render
Mesh</p></li>
<li><p>Constraints：</p>
<ul>
<li>划定布料每个顶点的运动范围</li>
<li>一般离人体越近，运动范围越小 eg.披风脖子处运动幅度小</li>
<li>解决衣料穿模问题</li>
</ul></li>
<li><p>布料物理材质（丝绸/棉布等）</p></li>
</ul>
<h5 id="cloth-solver---mass-spring-system">Cloth Solver - Mass Spring
System</h5>
<ul>
<li><p>质点弹簧系统</p>
<ul>
<li><p>Spring force 胡克力 <span class="math display">\[
\vec F^S=k_{\rm spring}\Delta\vec x
\]</span></p></li>
<li><p>Spring damping force （damping
衰减，空气阻力所致/提高迭代稳定性） <span class="math display">\[
\vec F^d=-k_{\rm damping}\vec v
\]</span></p></li>
</ul></li>
<li><p>横向、纵向、斜向、跨越质点加弹簧，提高精度
<img src="../images/games104/L11_MassSpringCloth.png" alt="L11_MassSpringCloth" style="zoom:20%;" /></p></li>
<li><p>受力</p>
<ul>
<li>重力</li>
<li>风力</li>
<li>空气阻力</li>
<li>周围弹簧弹力（胡克力 + damping） <span class="math display">\[
\vec F_{\rm net}^{\rm vertex}=M\vec g+\vec F_{\rm wind}(t)+\vec F_{\rm
air\ resistance}(t)+\sum_{\rm springs\in v}(k_{\rm spring}\Delta \vec
x(t)-k_{\rm damping}\vec v(t))=M\vec a(t)
\]</span></li>
</ul></li>
<li><p>Verlet数值积分 <span class="math display">\[
\vec x(t+\Delta t)=2\vec x(t)-\vec x(t-\Delta t)+\vec a(t)(\Delta t)^2
\]</span></p>
<ul>
<li>半隐式欧拉积分 <span class="math display">\[
\vec v(t+\Delta t)=\vec v(t)+\vec a(t)\Delta t \\ \vec x(t+\Delta
t)=\vec x(t)+\vec v(t+\Delta t)\Delta t
\]</span></li>
<li>Observation <span class="math display">\[
\left\{\begin{array}{l}\vec v(t+\Delta t)=\vec v(t)+\vec a(t)\Delta t \\
\vec x(t+\Delta t)=\vec x(t)+\vec v(t+\Delta t)\Delta t\\
\vec x(t)=\vec x(t-\Delta t)+\vec v(t)\Delta t
\end{array}\right.\ \Rightarrow\
\left\{\begin{array}{l}
\vec x(t+\Delta t)=\vec x(t)+(\vec v(t)+\vec a(t)\Delta t)\Delta t\\
\vec x(t)=\vec x(t-\Delta t)+\vec v(t)\Delta t
\end{array}\right.
\]</span></li>
<li>得到 <span class="math display">\[
\vec x(t+\Delta t)=2\vec x(t)-\vec x(t-\Delta t)+\vec a(t)(\Delta t)^2
\]</span></li>
<li>与半隐式欧拉积分数学等价，但实现上因为排除了不稳定的速度因素，更加稳定</li>
</ul></li>
</ul>
<h5 id="cloth-solver---position-based-dynamics">Cloth Solver - Position
Based Dynamics</h5>
<ul>
<li>区别
<ul>
<li>传统Simulation：Constrains =&gt; Force =&gt; Velocity =&gt;
Position</li>
<li>PBD：Constrains ==&gt; Position</li>
</ul></li>
<li>用约束描述物理属性</li>
<li>Solver更稳定</li>
<li>后面会再进一步解释</li>
</ul>
<h5 id="self-collision">Self Collision</h5>
<p>包括布料与布料、布料与刚体的碰撞，精度较低时极易发生</p>
<ul>
<li>暴力方法：加厚布料（渲染时），发生自穿插时不会渲染出来</li>
<li>提高迭代精度，减小迭代Step</li>
<li>Maximal velocity 这样每次穿插不会过深，可以在下次迭代时弹回</li>
<li>增加一个负向力场，负向SDF实现</li>
</ul>
<h4 id="destruction">Destruction</h4>
<ul>
<li><p>Chunk Hierarchy，组织未破碎物体的碎片</p></li>
<li><p>Connectivity Graph，生成连接关系，每个Edge有Connectivity
Value</p></li>
<li><p>Damage Calculation，受力超过Connectivity Value则破坏连接</p>
<ul>
<li>Impact Point向外扩散
<img src="../images/games104/L11_DamageRange.png" alt="L11_DamageRange" style="zoom:15%;" />
<span class="math display">\[
D_d=\left\{\begin{aligned}
&amp;D &amp;&amp;d\le R_\min\\
&amp;D\cdot\left(\dfrac{R_\max-d}{R_\max-R_\min}\right)^K
&amp;&amp;R_\min&lt;d&lt;R_\max\\
&amp;0 &amp;&amp;d\ge R_\max\quad
\end{aligned}\right.
\]</span></li>
</ul></li>
<li><p>Pin住某些与世界的连接</p></li>
<li><p>Voronoi生成Chunk</p>
<ul>
<li><span class="citation" data-cites="PBA">@PBA</span>
随机取点，等距垂平面</li>
<li>断面纹理生成
<ul>
<li>实时的3D Texture生成</li>
<li>离线生成，runtime切换</li>
</ul></li>
<li>Chunk的分布 =&gt; 取点的分布</li>
</ul></li>
<li><p>Pipeline
<img src="../images/games104/L11_DestructionPipeline.jpg" alt="L11_DestructionPipeline" style="zoom: 50%;" /></p></li>
<li><p>增加其他真实感效果</p>
<ul>
<li>音效</li>
<li>粒子</li>
<li>Navigation更新</li>
</ul></li>
<li><p>谨慎使用，增加了大量Mesh，对算力要求很高</p></li>
</ul>
<h4 id="vehicle">Vehicle</h4>
<ul>
<li><p>A rigidbody actor
<img src="../images/games104/L11_RigidbodyVehicle.jpg" alt="L11_RigidbodyVehicle" style="zoom: 50%;" /></p></li>
<li><p>驱动力 Traction Force
<img src="../images/games104/L11_TractionForce1.png" alt="L11_TractionForce1" style="zoom: 20%;" /></p>
<ul>
<li>扭矩 Torque <span class="math inline">\(T=T_{\rm
engine}X_gX_dn\)</span>
<img src="../images/games104/L11_TractionForce2.png" alt="L11_TractionForce2" style="zoom:20%;" /></li>
<li>驱动力 Traction <span class="math inline">\(\vec F_{\rm
Traction}=\dfrac{T}{R_w}\vec u\)</span></li>
</ul></li>
<li><p>悬挂力 Suspension Force
<img src="../images/games104/L11_SuspensionForce1.png" alt="L11_SuspensionForce1" style="zoom:20%;" />
<span class="math display">\[
|\vec F_{\rm suspension}|=k(L_{\rm rest}-(L_{
\rm hit}-R_W))
\]</span>
<img src="../images/games104/L11_SuspensionForce2.png" alt="L11_SuspensionForce2" style="zoom:20%;" /></p></li>
<li><p>轮胎力 Tire Forces</p>
<ul>
<li>径向力 Longitudinal force <span class="math inline">\(F_{\rm
long}=F_{\rm traction}+F_{\rm drag}+F_{rr}\)</span>
<img src="../images/games104/L11_TireForce1.png" alt="L11_TireForce1" style="zoom:20%;" /></li>
<li>切向力 Lateral force <span class="math inline">\(F_{\rm
lateral}=C_c*a\)</span>
<img src="../images/games104/L11_TireForce2.png" alt="L11_TireForce2" style="zoom:20%;" />
<img src="../images/games104/L11_TireForce3.png" alt="L11_TireForce3" style="zoom:20%;" /></li>
</ul></li>
<li><p>重心 Center of Mass
<img src="../images/games104/L11_CenterOfMass1.png" alt="L11_CenterOfMass1" style="zoom:20%;" />
<span class="math display">\[
M=M_1+M_2\quad \vec x_{cm}=\dfrac{M_1\vec x_1+M_2\vec x_2}{M}
\]</span>
<img src="../images/games104/L11_CenterOfMass2.png" alt="L11_CenterOfMass2" style="zoom:20%;" /></p>
<ul>
<li>重心太靠前在飞跃时容易栽，重心准确则稳定</li>
<li>重心靠前转向力不足，靠后转向力过大</li>
<li>变速时重心会有偏移 Weight Transfer
加速时车身后仰重心靠后，刹车时车身前倾重心靠前</li>
</ul></li>
<li><p>转向角</p>
<ul>
<li><p>转向时，若内外侧轮转向角相同，则外侧轮打滑空转</p></li>
<li><p>转向时，外侧轮转向角要大于内侧轮</p></li>
<li><p>根据旋转中心计算
<img src="../images/games104/L11_SteeringAngles1.png" alt="L11_SteeringAngles1" style="zoom:20%;" />
<span class="math display">\[
\alpha_l=\tan^{-1}\dfrac{L_{wb}}{R_t+\frac{L_r}{2}}\\
\alpha_r=\tan^{-1}\dfrac{L_{wb}}{R_t-\frac{L_r}{2}}
\]</span>
<img src="../images/games104/L11_SteeringAngles2.png" alt="L11_SteeringAngles2" style="zoom:20%;" /></p></li>
</ul></li>
<li><p>轮胎接触
<img src="../images/games104/L11_WheelContact.gif" alt="L11_WheelContact" style="zoom:20%;" /></p>
<ul>
<li>单方向垂直向下的 Single Raycast 效果不真实，易发生穿插</li>
<li>球面 Spherecast 实现真实的接触</li>
</ul></li>
</ul>
<h4 id="advanced-physics-pbd-xpbd">Advanced Physics : PBD / XPBD</h4>
<ul>
<li>拉格朗日力学：用约束描述所有运动，把力学计算改变为求解约束问题</li>
<li>eg. 匀速圆周运动
<ul>
<li>位置约束 <span class="math inline">\(C(\mathbf x)=\|\mathbf
x\|-r=0\)</span></li>
<li>速度约束 <span class="math inline">\(\dfrac{\mathrm d}{\mathrm
dt}C(\mathbf x)=\dfrac{\mathrm dC}{\mathrm d\mathbf x}\cdot
\dfrac{d\mathbf x}{\mathrm dt}=\mathbf J\cdot\mathbf v=0\)</span></li>
</ul></li>
<li><span class="math inline">\(\mathbf J\)</span> Jacobian
<ul>
<li><span class="math inline">\(\mathbf J^T\)</span> 与 <span
class="math inline">\(\mathbf v\)</span> 垂直 <span
class="math inline">\(\mathbf J^T\cdot\mathbf v=0\)</span></li>
<li>把速度转换成速度约束</li>
</ul></li>
<li>弹簧质点等系统也都可用约束表示 eg. 弹簧质点系统拉伸时：<span
class="math inline">\(C_{\rm stretch}(\mathbf x_1, \mathbf
x_2)=\|\mathbf x_1-\mathbf x_2\|-d\)</span>
<img src="../images/games104/L11_StringConstraints2.png" alt="L11_StringConstraints2" style="zoom:15%;" /><img src="../images/games104/L11_StringConstraints1.png" alt="L11_StringConstraints1" style="zoom:15%;" /></li>
</ul>
<h5 id="pbd-position-based-dynamics">PBD, Position Based Dynamics</h5>
<ul>
<li>约束投影</li>
<li>求解约束的方法：迭代法</li>
<li>Jacobi矩阵指向正确的方向，反复迭代直到满足约束（接近）</li>
<li>收敛相对稳定</li>
<li>布料应用广泛</li>
<li>NVIDIA Flex</li>
</ul>
<p><img src="../images/games104/L11_PBD2.png" alt="L11_PBD2" style="zoom:25%;" /></p>
<p><img src="../images/games104/L11_PBD1.png" alt="L11_PBD1" style="zoom:25%;" /></p>
<p><img src="../images/games104/L11_PBD3.jpg" alt="L11_PBD3" style="zoom: 67%;" /></p>
<h5 id="xpbd-extended-position-based-dynamics">XPBD, Extended Position
Based Dynamics</h5>
<ul>
<li><p>在PBD基础上引入stiffness量，表示硬约束还是软约束</p></li>
<li><p>硬约束：stiffness非常大，易爆炸</p></li>
<li><p>软约束：stiffness较小，布料等软体</p></li>
<li><p><span class="math display">\[
U(\mathbf x)=\dfrac{1}{2}\mathbf C(\mathbf x)^T\alpha^{-1}\mathbf
C(\mathbf x)\quad \alpha:\text{stiffness}
\]</span></p>
<p>将约束转换为服从性矩阵 Compliance Matrix</p></li>
<li><p>Unreal Engine Chaos</p></li>
</ul>

  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="//elderlyaugustus.github.io/posts/2022-06-18-games104%E7%8E%B0%E4%BB%A3%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-lecture12-effects.html">
    <span class="title">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline></svg>&nbsp;Prev Page</span>
    <br>
    <span>2022-06-18-GAMES104现代游戏引擎-Lecture12-Effects</span>
  </a>
  <a class="next" href="//elderlyaugustus.github.io/posts/2022-05-25-games104%E7%8E%B0%E4%BB%A3%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E-lecture10-physicssystemconcepts.html">
    <span class="title">Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg>
    </span>
    <br>
    <span>2022-05-25-GAMES104现代游戏引擎-Lecture10-Physics System - Basic Concepts</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2022 <a href="//elderlyaugustus.github.io/">xα&#39;s blog</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="../js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>
<script>
  mediumZoom('.entry-cover img');
  mediumZoom('.post-content img:not([no-zoom])');
</script>

<script src="../js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
</body>

</html>
